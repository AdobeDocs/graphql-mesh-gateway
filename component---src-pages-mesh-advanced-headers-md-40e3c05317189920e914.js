"use strict";(self.webpackChunkgraphql_mesh_gateway=self.webpackChunkgraphql_mesh_gateway||[]).push([[6418],{2174:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return i},default:function(){return u}});var r=a(58168),t=a(80045),o=(a(88763),a(15680)),d=a(83407);const s=["components"],i={},m=(h="InlineAlert",function(e){return console.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.mdx)("div",e)});var h;const l={_frontmatter:i},p=d.A;function u(e){let{components:n}=e,a=(0,t.A)(e,s);return(0,o.mdx)(p,(0,r.A)({},l,a,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"request-and-response-headers"},"Request and response headers"),(0,o.mdx)("p",null,"To specify headers for your mesh, you can add them inside the ",(0,o.mdx)("inlineCode",{parentName:"p"},"JSON")," file that describes your mesh, or you can add them when querying. Currently, you can add ",(0,o.mdx)("a",{parentName:"p",href:"#request-headers"},"request headers")," and ",(0,o.mdx)("a",{parentName:"p",href:"#response-headers"},"response headers"),", which both can contain ",(0,o.mdx)("a",{parentName:"p",href:"./caching/"},"cache-control headers"),"."),(0,o.mdx)("h2",{id:"request-headers"},"Request headers"),(0,o.mdx)("p",null,"Request headers provide more information about the request context. You can add request headers to your ",(0,o.mdx)("a",{parentName:"p",href:"#add-request-headers-in-your-mesh-file"},"mesh config"),"."),(0,o.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,o.mdx)("p",null,"API Mesh limits request headers to a maximum of 500."),(0,o.mdx)("h3",{id:"add-request-headers-in-your-mesh-file"},"Add request headers in your mesh file"),(0,o.mdx)("p",null,"To add headers directly to a source handler in your mesh JSON file, add the ",(0,o.mdx)("inlineCode",{parentName:"p"},"operationHeaders")," object with key-value pairs for your headers. The following example defines the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Store")," header for the Commerce source and multiple headers for the LiveSearch source."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "meshConfig": {\n    "sources": [\n      {\n        "name": "Commerce",\n        "handler": {\n          "graphql": {\n            "endpoint": "https://<host>/graphql",\n            "operationHeaders": {\n              "Store": "default"\n            }\n          }\n        }\n      },\n      {\n        "name": "LiveSearch",\n        "handler": {\n          "graphql": {\n            "endpoint": "https://<host>/search/graphql",\n            "operationHeaders": {\n              "Magento-Environment-Id": "<environment_id>",\n              "Magento-Website-Code": "base",\n              "Magento-Store-Code": "main_website_store",\n              "Magento-Store-View-Code": "default",\n              "X-Api-Key": "search_gql"\n            }\n          }\n        }\n      }\n    ]\n  },\n}\n')),(0,o.mdx)("p",null,"You can also inject dynamic values from the context into your headers. For examples of dynamic header values, select a handler:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("a",{parentName:"li",href:"../basic/handlers/openapi.md#headers-from-context"},"OpenAPI handlers")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("a",{parentName:"li",href:"../basic/handlers/graphql.md#headers-from-context"},"GraphQL handlers")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("a",{parentName:"li",href:"../basic/handlers/json-schema.md#headers-from-context"},"JSON Schema handlers"))),(0,o.mdx)("h4",{id:"request-id-header"},"Request ID header"),(0,o.mdx)("p",null,"The ",(0,o.mdx)("inlineCode",{parentName:"p"},"x-request-id")," header allows you to track and debug requests by assigning a user-specified ID number. If you provide this ID in the request header, then the response includes the header."),(0,o.mdx)("p",null,(0,o.mdx)("inlineCode",{parentName:"p"},"x-request-id: ABC123")),(0,o.mdx)("h4",{id:"media-types"},"Media types"),(0,o.mdx)("p",null,"Depending on the type of information you are passing in a header, your source might require that you specify a ",(0,o.mdx)("a",{parentName:"p",href:"https://www.iana.org/assignments/media-types/media-types.xhtml"},"media type"),", which tells the mesh and your sources how to interpret the data you are passing. Use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Content-Type")," key-value pair in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"operationHeaders")," object to define your content format."),(0,o.mdx)("p",null,"In the following example, the ",(0,o.mdx)("inlineCode",{parentName:"p"},'"Content-Type": "application/json"')," key-value pair indicates that the content is in JSON format."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'"operationHeaders": {\n  "Content-Type": "application/json",\n},\n')),(0,o.mdx)("h2",{id:"response-headers"},"Response headers"),(0,o.mdx)("p",null,"Response headers provide a detailed context of the response. Currently, you can only add response headers from the mesh config."),(0,o.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,o.mdx)("p",null,"All response header names must be unique. Conflicting header names will result in an error when you try to create or update a mesh."),(0,o.mdx)("h3",{id:"add-response-headers-in-your-mesh-file"},"Add response headers in your mesh file"),(0,o.mdx)("p",null,"Mesh owners can use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"responseConfig.headers")," object to add response headers. Define each header as a key-value pair."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'    { \n      "meshConfig": { \n        "sources": [\n          {\n            "name": "venia", \n            "handler": { \n              "graphql": { \n                "endpoint": "https://venia.magento.com/graphql"\n              } \n            } \n          }\n        ],\n       "responseConfig": {\n        "headers": {\n            "Cache-Control": "max-age=60480",\n            "Vary": "Accept"\n          }\n        }\n      }\n    }\n')),(0,o.mdx)("h4",{id:"return-forwarded-headers"},"Return forwarded headers"),(0,o.mdx)("p",null,"The ",(0,o.mdx)("inlineCode",{parentName:"p"},"responseConfig.headers")," object also allows you to return header values from a source. The following example requests the ",(0,o.mdx)("inlineCode",{parentName:"p"},"X-Magento-Cache-Id")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"X-Cache")," headers from the Venia source."),(0,o.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,o.mdx)("p",null,(0,o.mdx)("a",{parentName:"p",href:"../basic/handlers/json-schema.md"},"JSON Schema handlers")," do not support ",(0,o.mdx)("inlineCode",{parentName:"p"},"responseConfig")," functionality."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "meshConfig": {\n    "sources": [\n      {\n        "name": "venia",\n        "handler": {\n          "graphql": {\n            "endpoint": "https://venia.magento.com/graphql"\n          }\n        },\n        "responseConfig": {\n          "headers": [\n            "X-Magento-Cache-Id",\n            "X-Cache"\n          ]\n        }\n      }\n    ]\n  }\n}\n')),(0,o.mdx)("h4",{id:"conflicting-headers"},"Conflicting headers"),(0,o.mdx)("p",null,"When forwarding headers, an error occurs if two or more sources return a header with the same name. To view all headers, regardless of source, add the ",(0,o.mdx)("inlineCode",{parentName:"p"},"x-include-metadata")," header with a value of ",(0,o.mdx)("inlineCode",{parentName:"p"},"true")," in your GraphQL client."),(0,o.mdx)("p",null,"Including metadata prefixes the returned response headers with their source name. In the following example, the ",(0,o.mdx)("inlineCode",{parentName:"p"},"cache-control")," header values are returned for the ",(0,o.mdx)("inlineCode",{parentName:"p"},"venia")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"commerce")," sources."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    ...\n    },\n  "_ggw_metadata__": {\n        "responseHeaders": {\n          "x-venia-cache-control": "max-age=3600",\n          "x-commerce-cache-control": "max-age=1800",\n        }\n    }\n}\n')),(0,o.mdx)("h2",{id:"retrieving-handler-details"},"Retrieving handler details"),(0,o.mdx)("p",null,"Setting an ",(0,o.mdx)("inlineCode",{parentName:"p"},"httpDetails")," header to ",(0,o.mdx)("inlineCode",{parentName:"p"},"true")," no longer returns ",(0,o.mdx)("inlineCode",{parentName:"p"},"httpDetails")," when querying. Instead, the setting is now controlled at the mesh level by the ",(0,o.mdx)("a",{parentName:"p",href:"../basic/work-with-mesh.md#include-httpdetails-in-query-responses"},(0,o.mdx)("inlineCode",{parentName:"a"},"includeHTTPDetails")," setting"),"."),(0,o.mdx)("h2",{id:"header-troubleshooting"},"Header troubleshooting"),(0,o.mdx)("h3",{id:"fastly-prefixing"},"Fastly Prefixing"),(0,o.mdx)("p",null,'API mesh prefixes any Fastly source headers with their source name. For example, a source named "commerce" with an ',(0,o.mdx)("inlineCode",{parentName:"p"},"x-magento-cache-id")," header is converted to ",(0,o.mdx)("inlineCode",{parentName:"p"},"x-commerce-magento-cache-id"),'. However, if your endpoint URL contains "magento", API Mesh assumes you are connecting to an Adobe Commerce instance and does not prefix your headers with a source name. Using the previous example, your header would remain ',(0,o.mdx)("inlineCode",{parentName:"p"},"x-magento-cache-id"),"."),(0,o.mdx)("h3",{id:"401-errors"},"401 errors"),(0,o.mdx)("p",null,"If you receive a ",(0,o.mdx)("inlineCode",{parentName:"p"},"401")," or similar error when passing headers, add the following content-type specification to your mesh configuration file, as described in ",(0,o.mdx)("a",{parentName:"p",href:"#media-types"},"media types"),". This issue can occur when you pass your authorization credentials, such as username and password, to an endpoint, but the endpoint does not know how to consume that information. Specifying the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Content-Type")," tells your endpoint how to parse the request body."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'"operationHeaders": {\n  "Content-Type": "application/json",\n},\n')))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-mesh-advanced-headers-md-40e3c05317189920e914.js.map