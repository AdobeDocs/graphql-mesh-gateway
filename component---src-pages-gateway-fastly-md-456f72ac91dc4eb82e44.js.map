{"version":3,"file":"component---src-pages-gateway-fastly-md-456f72ac91dc4eb82e44.js","mappings":"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","sources":["webpack://graphql-mesh-gateway/./src/pages/gateway/fastly.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/graphql-mesh-gateway/graphql-mesh-gateway/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"fastly-configuration\"\n    }}>{`Fastly configuration`}</h1>\n    <p>{`Using `}<a parentName=\"p\" {...{\n        \"href\": \"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/cdn/fastly.html?lang=en\"\n      }}>{`Fastly`}</a>{` as a content delivery network (CDN) with API Mesh for Adobe Developer App Builder provides additional security and improved performance. To fully integrate API Mesh, Fastly, and Adobe Commerce, you must follow the configuration instructions in the following sections.`}</p>\n    <h2 {...{\n      \"id\": \"configure-fastly-in-adobe-commerce\"\n    }}>{`Configure Fastly in Adobe Commerce`}</h2>\n    <p>{`Use the following process to configure edge caching for Adobe Commerce using the provided Fastly CDN.`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><a parentName=\"p\" {...{\n            \"href\": \"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/cdn/setup-fastly/fastly-configuration.html?lang=en#get-fastly-credentials\"\n          }}>{`Get your Fastly credentials`}</a>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`In the Adobe Commerce Admin, select `}<strong parentName=\"p\">{`Store`}</strong>{` > Settings > `}<strong parentName=\"p\">{`Configuration`}</strong>{` > `}<strong parentName=\"p\">{`Advanced`}</strong>{` > `}<strong parentName=\"p\">{`System`}</strong>{` > `}<strong parentName=\"p\">{`Full Page Cache`}</strong>{` and set the `}<strong parentName=\"p\">{`Caching Application`}</strong>{` field to `}<strong parentName=\"p\">{`Fastly CDN`}</strong>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Enter the Fastly credentials you retrieved previously into the `}<strong parentName=\"p\">{`Fastly Service ID`}</strong>{` and `}<strong parentName=\"p\">{`Fastly API Token`}</strong>{` fields. Then click the Test Credentials button to verify that your credentials are correct.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Under `}<strong parentName=\"p\">{`Fastly Configuration`}</strong>{` > `}<strong parentName=\"p\">{`Custom VCL Snippets`}</strong>{` click `}<strong parentName=\"p\">{`Create`}</strong>{` and add the following `}<a parentName=\"p\" {...{\n            \"href\": \"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/cdn/custom-vcl-snippets/fastly-vcl-custom-snippets.html\"\n          }}>{`snippets`}</a>{`. For more information on VCL subroutines, see `}<a parentName=\"p\" {...{\n            \"href\": \"https://developer.fastly.com/reference/vcl/subroutines/\"\n          }}>{`Custom Subroutines`}</a>{`.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Indicates when to bypass the cache:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_bypass`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`recv`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`60`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if ((req.request == \"GET\" || req.request == \"HEAD\") && (req.url.path~\"/graphql\" || req.url \"^/api/(.*)\") && req.url.qs~\"query=\" && req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  set req.http.graphql = \"1\";\n}\nelse {\n  unset req.http.graphql;\n}\nif (req.url.path!~\"/graphql\" && req.url!~\"^/api/(.*)\") {\n  set req.http.Magento - Original - URL = req.url;\n\n  set req.url = querystring.regfilter(req.url, \"^(utm_.*|gclid|gdftrk|_ga|mc_.*|trk_.*|dm_i|_ke|sc_.*|fbclid)$\");\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Allows API Mesh to function as a backend:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_backend`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`init`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`1`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`backend F_graph_prod_adobe_io {\n    .always_use_host_header = true;\n    .between_bytes_timeout = 10s;\n    .connect_timeout = 1s;\n    .dynamic = true;\n    .first_byte_timeout = 15s;\n    .host = \"graph.adobe.io\";\n    .host_header = \"graph.adobe.io\";\n    .max_connections = 200;\n    .port = \"443\";\n    .share_key = \"XXXXXXXXXXXXXXXX\";\n    .ssl = true;\n    .ssl_cert_hostname = \"graph.adobe.io\";\n    .ssl_check_cert = always;\n    .ssl_sni_hostname = \"graph.adobe.io\";\n    .probe = {\n        .dummy = true;\n        .initial = 5;\n        .request = \"HEAD / HTTP/1.1\" \"Host: graph.adobe.io\" \"Connection: close\";\n        .threshold = 1;\n        .timeout = 2s;\n        .window = 5;\n    }\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Enables the bypass header in API Mesh:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_recv`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`recv`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  return (pass);\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache miss - replace the `}<inlineCode parentName=\"p\">{`<mesh_id>`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`<mesh_api_key>`}</inlineCode>{` placeholders with the information from your mesh URL, which has the following structure: `}<inlineCode parentName=\"p\">{`https://graph.adobe.io/api/<meshId>/graphql?api_key=<your_apiKey>`}</inlineCode>{`:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_miss`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`miss`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`60`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.url~\"^/api/\") {\n  set req.backend = F_graph_prod_adobe_io;\n}\n//API Mesh prod mapping\nif (req.url~\"^/api/<mesh_id>\") {\n  set bereq.http.x - api - key = \"<mesh_api_key>\";\n}\n# //Optionally add another environment\n# //API Mesh stage mapping\n# if (req.url~\"^/api/<mesh_id>\") {\n#   set bereq.http.x - api - key = \"<mesh_api_key>\";\n# }\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n        </ul>\n        <p parentName=\"li\">{`The following `}<inlineCode parentName=\"p\">{`api_mesh_pass`}</inlineCode>{` snippet allows you to query your mesh URL without appending the `}<inlineCode parentName=\"p\">{`api_key`}</inlineCode>{`:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache pass - replace the `}<inlineCode parentName=\"p\">{`<mesh_id>`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`<mesh_api_key>`}</inlineCode>{` placeholders with the information from your mesh URL, which has the following structure: `}<inlineCode parentName=\"p\">{`https://graph.adobe.io/api/<meshId>/graphql?api_key=<mesh_api_key>`}</inlineCode>{`:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_pass`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`pass`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.url ~ \"^/api/\") {\n  set req.backend = F_graph_prod_adobe_io;\n}\n//API Mesh prod mapping\nif (req.url ~ \"^/api/<mesh_id>\") {\n  set bereq.http.x-api-key = \"<mesh_api_key>\";\n}\n# //Optionally add another environment\n# //API Mesh stage mapping\n# if (req.url ~ \"^/api/<mesh_id>\") {\n#   set bereq.http.x-api-key = \"<mesh_api_key>\";\n# }\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache fetch:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_fetch`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`fetch`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  return (pass);\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache deliver:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_deliver`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`deliver`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  return (deliver);\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`In `}<strong parentName=\"p\">{`Fastly Configuration`}</strong>{` > `}<strong parentName=\"p\">{`Backend Settings`}</strong>{` click `}<strong parentName=\"p\">{`Create`}</strong>{`. Add a new backend with the following information:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Condition`}</strong>{` - `}<inlineCode parentName=\"li\">{`req.url ~ \"^/api/(.*)\" ,`}</inlineCode></li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Address`}</strong>{` - `}<strong parentName=\"li\">{`graph.adobe.io`}</strong></li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Priority`}</strong>{` - `}<strong parentName=\"li\">{`8`}</strong></li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`In `}<strong parentName=\"p\">{`Fastly Configuration`}</strong>{` click `}<strong parentName=\"p\">{`Upload VCL to Fastly`}</strong>{`. Click `}<strong parentName=\"p\">{`Save Config`}</strong>{`.`}</p>\n      </li>\n    </ol>\n    <h2 {...{\n      \"id\": \"configure-headers-in-api-mesh\"\n    }}>{`Configure headers in API Mesh`}</h2>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`After adding VCL snippets in the `}<a parentName=\"p\" {...{\n        \"href\": \"#configure-fastly-in-adobe-commerce\"\n      }}>{`Fastly Setup`}</a>{`, your Commerce GraphQL URL is now in the following format with no `}<inlineCode parentName=\"p\">{`api_key`}</inlineCode>{` appended: `}<inlineCode parentName=\"p\">{`https://graph.adobe.io/api/<meshId>/graphql`}</inlineCode></p>\n    <p>{`To distinguish between requests from users and requests from API Mesh, use the following source operation header to prevent Fastly from caching headers that come directly from API Mesh:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`\"x-commerce-bypass-fastly-cache\": \"true\" \n`}</code></pre>\n    <p>{`When bypassing the cache, you must also specify which headers should be preserved in the `}<inlineCode parentName=\"p\">{`responseConfig`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`\"responseConfig\": {\n  \"headers\": [\n    \"x-magento-cache-id\",\n    \"x-magento-tags\",\n    \"set-cookie\",\n    \"pragma\",\n    \"cache-control\",\n    \"expires\",\n    \"x-content-type-options\",\n    \"x-xss-protection\",\n    \"x-platform-server\"\n  ]\n}\n`}</code></pre>\n    <p>{`Using Fastly also requires all queries to be `}<inlineCode parentName=\"p\">{`GET`}</inlineCode>{` queries. If you do not use `}<inlineCode parentName=\"p\">{`GET`}</inlineCode>{` queries, they will not be cached. To enforce this in your mesh, add the following configuration option:`}</p>\n    <p><inlineCode parentName=\"p\">{`\"useGETForQueries\": true`}</inlineCode></p>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`Use the `}<inlineCode parentName=\"p\">{`fastly-debug:1`}</inlineCode>{` request header to get more information from Fastly on each request.`}</p>\n    <h3 {...{\n      \"id\": \"fastly-example-mesh\"\n    }}>{`Fastly example mesh`}</h3>\n    <p>{`The following example mesh specifies the headers to cache, enables the cache bypass, and sets all queries to pass as `}<inlineCode parentName=\"p\">{`GET`}</inlineCode>{` queries.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"meshConfig\": {\n    \"responseConfig\": {\n      \"includeHTTPDetails\": true\n    },\n    \"sources\": [\n      {\n        \"name\": \"Core\",\n        \"handler\": {\n          \"graphql\": {\n            \"endpoint\": \"https://venia.magento.com/graphql\",\n            \"operationHeaders\": {\n              \"x-magento-cache-id\": \"{context.headers['x-magentocache-id']}\",\n              \"Store\": \"{context.headers['store']}\" ,\n              \"Authorization\": \"{context.headers['authorization']}\",\n              \"Content-Type\": \"application/json\",\n              \"x-commerce-bypass-fastly-cache\": \"true\"\n            },\n            \"useGETForQueries\": true\n          }\n        },\n        \"responseConfig\": {\n          \"headers\": [\n            \"x-magento-cache-id\",\n            \"x-cache\",\n            \"x-magento-tags\",\n            \"set-cookie\",\n            \"pragma\",\n            \"cache-control\",\n            \"expires\",\n            \"x-content-type-options\",\n            \"x-xss-protection\",\n            \"x-platform-server\"\n          ]\n        }\n      }\n    ]\n  }\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"cache-header-prefixing\"\n    }}>{`Cache Header Prefixing`}</h3>\n    <p>{`API Mesh prefixes any Fastly source headers with their source name. For example, a source named \"commerce\" with an `}<inlineCode parentName=\"p\">{`x-magento-cache-id`}</inlineCode>{` header is converted to `}<inlineCode parentName=\"p\">{`x-commerce-magento-cache-id`}</inlineCode>{`. However, if your endpoint URL contains \"magento\", API Mesh assumes you are connecting to an Adobe Commerce instance and does not prefix your headers with a source name. Using the previous example, your header would remain `}<inlineCode parentName=\"p\">{`x-magento-cache-id`}</inlineCode>{`.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","InlineAlert","name","props","console","warn","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","variant","slots","isMDXComponent"],"sourceRoot":""}