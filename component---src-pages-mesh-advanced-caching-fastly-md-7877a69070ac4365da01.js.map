{"version":3,"file":"component---src-pages-mesh-advanced-caching-fastly-md-7877a69070ac4365da01.js","mappings":"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","sources":["webpack://graphql-mesh-gateway/./src/pages/mesh/advanced/caching/fastly.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/graphql-mesh-gateway/graphql-mesh-gateway/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"dynamic-cache-control-with-fastly\"\n    }}>{`Dynamic cache control with Fastly`}</h1>\n    <p>{`Adding a content delivery network (CDN) for caching dynamic content with API Mesh for Adobe Developer App Builder provides additional security and improved performance. Follow these instructions to integrate API Mesh, Adobe Commerce, and `}<a parentName=\"p\" {...{\n        \"href\": \"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/cdn/fastly.html?lang=en\"\n      }}>{`Fastly`}</a>{` (provided with Adobe Commerce Pro accounts).`}</p>\n    <h2 {...{\n      \"id\": \"configure-headers-in-api-mesh\"\n    }}>{`Configure headers in API Mesh`}</h2>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`After adding VCL snippets in the `}<a parentName=\"p\" {...{\n        \"href\": \"#configure-fastly-in-adobe-commerce\"\n      }}>{`Fastly Setup`}</a>{`, your Commerce GraphQL URL is now in the following format with no `}<inlineCode parentName=\"p\">{`api_key`}</inlineCode>{` appended: `}<inlineCode parentName=\"p\">{`https://graph.adobe.io/api/<meshId>/graphql`}</inlineCode></p>\n    <p>{`To distinguish between requests from users and requests from API Mesh, use the following source operation header to prevent Fastly from caching headers that come directly from API Mesh:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`\"x-commerce-bypass-fastly-cache\": \"true\" \n`}</code></pre>\n    <p>{`When bypassing the cache, you must also specify which headers should be preserved in the `}<inlineCode parentName=\"p\">{`responseConfig`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`\"responseConfig\": {\n  \"headers\": [\n    \"x-magento-cache-id\",\n    \"x-magento-tags\",\n    \"set-cookie\",\n    \"pragma\",\n    \"cache-control\",\n    \"expires\",\n    \"x-content-type-options\",\n    \"x-xss-protection\",\n    \"x-platform-server\"\n  ]\n}\n`}</code></pre>\n    <p>{`Using Fastly also requires all queries to be `}<inlineCode parentName=\"p\">{`GET`}</inlineCode>{` queries. `}<inlineCode parentName=\"p\">{`POST`}</inlineCode>{` queries are not cached. To enforce this in your mesh, add the following configuration option:`}</p>\n    <p><inlineCode parentName=\"p\">{`\"useGETForQueries\": true`}</inlineCode></p>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`Use the `}<a parentName=\"p\" {...{\n        \"href\": \"https://developer.fastly.com/reference/http/http-headers/Fastly-Debug/\"\n      }}><inlineCode parentName=\"a\">{`fastly-debug:1`}</inlineCode></a>{` request header to get more information from Fastly on each request. Adobe does not recommend using debug headers in production environments.`}</p>\n    <h3 {...{\n      \"id\": \"fastly-example-mesh\"\n    }}>{`Fastly example mesh`}</h3>\n    <p>{`The following example mesh specifies the headers to cache, enables the cache bypass, and sets all queries to pass as `}<inlineCode parentName=\"p\">{`GET`}</inlineCode>{` queries.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"meshConfig\": {\n    \"responseConfig\": {\n      \"includeHTTPDetails\": true\n    },\n    \"sources\": [\n      {\n        \"name\": \"Core\",\n        \"handler\": {\n          \"graphql\": {\n            \"endpoint\": \"https://venia.magento.com/graphql\",\n            \"operationHeaders\": {\n              \"x-magento-cache-id\": \"{context.headers['x-magentocache-id']}\",\n              \"Store\": \"{context.headers['store']}\" ,\n              \"Authorization\": \"{context.headers['authorization']}\",\n              \"Content-Type\": \"application/json\",\n              \"x-commerce-bypass-fastly-cache\": \"true\"\n            },\n            \"useGETForQueries\": true\n          }\n        },\n        \"responseConfig\": {\n          \"headers\": [\n            \"x-magento-cache-id\",\n            \"x-cache\",\n            \"x-magento-tags\",\n            \"set-cookie\",\n            \"pragma\",\n            \"cache-control\",\n            \"expires\",\n            \"x-content-type-options\",\n            \"x-xss-protection\",\n            \"x-platform-server\"\n          ]\n        }\n      }\n    ]\n  }\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"cache-header-prefixing\"\n    }}>{`Cache header prefixing`}</h3>\n    <p>{`API Mesh prefixes any Fastly source headers with their source name. For example, a source named \"commerce\" with an `}<inlineCode parentName=\"p\">{`x-magento-cache-id`}</inlineCode>{` header is converted to `}<inlineCode parentName=\"p\">{`x-commerce-magento-cache-id`}</inlineCode>{`. However, if your endpoint URL contains \"magento\", API Mesh assumes you are connecting to an Adobe Commerce instance and does not prefix your headers with a source name. Using the previous example, your header would remain `}<inlineCode parentName=\"p\">{`x-magento-cache-id`}</inlineCode>{`.`}</p>\n    <h3 {...{\n      \"id\": \"test-your-mesh\"\n    }}>{`Test your mesh`}</h3>\n    <p>{`After you `}<a parentName=\"p\" {...{\n        \"href\": \"../../basic/create-mesh.md#create-a-mesh\"\n      }}>{`create`}</a>{` or `}<a parentName=\"p\" {...{\n        \"href\": \"../../basic/create-mesh.md#update-an-existing-mesh\"\n      }}>{`update`}</a>{` your mesh, run an `}<a parentName=\"p\" {...{\n        \"href\": \"../../advanced/index.md#aio-api-meshdescribe\"\n      }}><inlineCode parentName=\"a\">{`aio api-mesh:describe`}</inlineCode></a>{` command to view your mesh URL. Run a query against this URL to confirm that your mesh is working correctly.`}</p>\n    <h2 {...{\n      \"id\": \"configure-fastly-in-adobe-commerce\"\n    }}>{`Configure Fastly in Adobe Commerce`}</h2>\n    <p>{`After setting up your API Mesh, open your Adobe Commerce Admin and use the following steps to configure dynamic content caching with the provided Fastly CDN. You will need access to the following prerequisites:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Adobe Commerce`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Admin access`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`API Mesh`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`The ability to create or update a mesh`}</li>\n        </ul>\n      </li>\n    </ul>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><a parentName=\"p\" {...{\n            \"href\": \"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/cdn/setup-fastly/fastly-configuration.html?lang=en#get-fastly-credentials\"\n          }}>{`Get the following Fastly credentials`}</a>{`:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Fastly Service ID`}</li>\n          <li parentName=\"ul\">{`Fastly API Token`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`In the Adobe Commerce Admin, select `}<strong parentName=\"p\">{`Store`}</strong>{` > Settings > `}<strong parentName=\"p\">{`Configuration`}</strong>{` > `}<strong parentName=\"p\">{`Advanced`}</strong>{` > `}<strong parentName=\"p\">{`System`}</strong>{` > `}<strong parentName=\"p\">{`Full Page Cache`}</strong>{` and set the `}<strong parentName=\"p\">{`Caching Application`}</strong>{` field to `}<strong parentName=\"p\">{`Fastly CDN`}</strong>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Enter the Fastly credentials you retrieved previously into the `}<strong parentName=\"p\">{`Fastly Service ID`}</strong>{` and `}<strong parentName=\"p\">{`Fastly API Token`}</strong>{` fields. Then click the `}<strong parentName=\"p\">{`Test Credentials`}</strong>{` button to verify that your credentials are correct.`}</p>\n        <p parentName=\"li\"><span parentName=\"p\" {...{\n            \"className\": \"gatsby-resp-image-wrapper\",\n            \"style\": {\n              \"position\": \"relative\",\n              \"display\": \"block\",\n              \"marginLeft\": \"auto\",\n              \"marginRight\": \"auto\",\n              \"maxWidth\": \"1280px\"\n            }\n          }}>{`\n      `}<span parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"48.12500000000001%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"display\": \"block\",\n                \"transition\": \"opacity 0.5s 0.5s\",\n                \"pointerEvents\": \"none\"\n              }\n            }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n                \"srcSet\": [\"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/5530d/fastly-credentials.webp 320w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/0c8fb/fastly-credentials.webp 640w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/94b1e/fastly-credentials.webp 1280w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/0b34d/fastly-credentials.webp 1920w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/f15af/fastly-credentials.webp 2350w\"],\n                \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n                \"type\": \"image/webp\"\n              }}></source>{`\n          `}<source parentName=\"picture\" {...{\n                \"srcSet\": [\"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/dd4a7/fastly-credentials.png 320w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/0f09e/fastly-credentials.png 640w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/bbbf7/fastly-credentials.png 1280w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/ac7a9/fastly-credentials.png 1920w\", \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/f9feb/fastly-credentials.png 2350w\"],\n                \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n                \"type\": \"image/png\"\n              }}></source>{`\n          `}<img parentName=\"picture\" {...{\n                \"className\": \"gatsby-resp-image-image\",\n                \"src\": \"/graphql-mesh-gateway/static/4db4bd2b0702749161300b6dad385ff3/bbbf7/fastly-credentials.png\",\n                \"alt\": \"fastly-credentials\",\n                \"title\": \"fastly-credentials\",\n                \"loading\": \"lazy\",\n                \"style\": {\n                  \"width\": \"100%\",\n                  \"height\": \"100%\",\n                  \"margin\": \"0\",\n                  \"verticalAlign\": \"middle\",\n                  \"position\": \"absolute\",\n                  \"opacity\": \"0\",\n                  \"transition\": \"opacity 0.5s\",\n                  \"color\": \"inherit\",\n                  \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n                  \"top\": \"0\",\n                  \"left\": \"0\"\n                }\n              }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Under `}<strong parentName=\"p\">{`Fastly Configuration`}</strong>{` > `}<strong parentName=\"p\">{`Custom VCL Snippets`}</strong>{` click `}<strong parentName=\"p\">{`Create`}</strong>{` and add the following `}<a parentName=\"p\" {...{\n            \"href\": \"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/cdn/custom-vcl-snippets/fastly-vcl-custom-snippets.html\"\n          }}>{`snippets`}</a>{`. For more information on VCL subroutines, see `}<a parentName=\"p\" {...{\n            \"href\": \"https://developer.fastly.com/reference/vcl/subroutines/\"\n          }}>{`Custom Subroutines`}</a>{`.`}</p>\n        <p parentName=\"li\"><strong parentName=\"p\">{`NOTE`}</strong>{`: The `}<inlineCode parentName=\"p\">{`Priority`}</inlineCode>{` of each VCL snippet determines the order in which VCL subroutines are executed. The following `}<inlineCode parentName=\"p\">{`Priority`}</inlineCode>{` fields only apply to the default configuration of Adobe Commerce. If you have other custom snippets, you will need to adjust the priorities accordingly.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Allows API Mesh to function as a `}<a parentName=\"p\" {...{\n                \"href\": \"https://developer.fastly.com/reference/vcl/declarations/backend/\"\n              }}>{`Fastly backend`}</a>{`:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_backend`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`init`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`1`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`backend F_graph_prod_adobe_io {\n    .always_use_host_header = true;\n    .between_bytes_timeout = 10s;\n    .connect_timeout = 1s;\n    .dynamic = true;\n    .first_byte_timeout = 15s;\n    .host = \"graph.adobe.io\";\n    .host_header = \"graph.adobe.io\";\n    .max_connections = 200;\n    .port = \"443\";\n    .share_key = \"XXXXXXXXXXXXXXXX\";\n    .ssl = true;\n    .ssl_cert_hostname = \"graph.adobe.io\";\n    .ssl_check_cert = always;\n    .ssl_sni_hostname = \"graph.adobe.io\";\n    .probe = {\n        .dummy = true;\n        .initial = 5;\n        .request = \"HEAD / HTTP/1.1\" \"Host: graph.adobe.io\" \"Connection: close\";\n        .threshold = 1;\n        .timeout = 2s;\n        .window = 5;\n    }\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Enables the bypass header in API Mesh:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_recv`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`recv`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  return (pass);\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Determines what GraphQL can be cached:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_recv2`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`recv`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`60`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if ((req.request == \"GET\" || req.request == \"HEAD\") && (req.url.path~\"/graphql\" || req.url \"^/api/(.*)\") && req.url.qs~\"query=\") {\n  set req.http.graphql = \"1\";\n}\nelse {\n  unset req.http.graphql;\n}\nif (req.url.path!~\"/graphql\" && req.url!~\"^/api/(.*)\") {\n  set req.http.Magento - Original - URL = req.url;\n\n  set req.url = querystring.regfilter(req.url, \"^(utm_.*|gclid|gdftrk|_ga|mc_.*|trk_.*|dm_i|_ke|sc_.*|fbclid)$\");\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache miss - replace the `}<inlineCode parentName=\"p\">{`<mesh_id>`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`<mesh_api_key>`}</inlineCode>{` placeholders with the information from your API Mesh URL, which has the following structure: `}<inlineCode parentName=\"p\">{`https://graph.adobe.io/api/<meshId>/graphql?api_key=<your_apiKey>`}</inlineCode>{`. You can retrieve this information by running an `}<a parentName=\"p\" {...{\n                \"href\": \"../../advanced/index.md#aio-api-meshdescribe\"\n              }}><inlineCode parentName=\"a\">{`aio api-mesh:describe`}</inlineCode></a>{` command:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_miss`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`miss`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`60`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.url~\"^/api/\") {\n  set req.backend = F_graph_prod_adobe_io;\n}\n//API Mesh prod mapping\nif (req.url~\"^/api/<mesh_id>\") {\n  set bereq.http.x - api - key = \"<mesh_api_key>\";\n}\n# //Optionally add another mesh\n# //API Mesh stage mapping\n# if (req.url~\"^/api/<mesh_id>\") {\n#   set bereq.http.x - api - key = \"<mesh_api_key>\";\n# }\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n        </ul>\n        <p parentName=\"li\">{`The following `}<inlineCode parentName=\"p\">{`api_mesh_pass`}</inlineCode>{` snippet allows you to query your mesh URL without appending the `}<inlineCode parentName=\"p\">{`api_key`}</inlineCode>{`:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache pass - replace the `}<inlineCode parentName=\"p\">{`<mesh_id>`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`<mesh_api_key>`}</inlineCode>{` placeholders with the information from your mesh URL, which has the following structure: `}<inlineCode parentName=\"p\">{`https://graph.adobe.io/api/<meshId>/graphql?api_key=<mesh_api_key>`}</inlineCode>{`:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_pass`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`pass`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.url ~ \"^/api/\") {\n  set req.backend = F_graph_prod_adobe_io;\n}\n//API Mesh prod mapping\nif (req.url ~ \"^/api/<mesh_id>\") {\n  set bereq.http.x-api-key = \"<mesh_api_key>\";\n}\n# //Optionally add another environment\n# //API Mesh stage mapping\n# if (req.url ~ \"^/api/<mesh_id>\") {\n#   set bereq.http.x-api-key = \"<mesh_api_key>\";\n# }\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache fetch:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_fetch`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`fetch`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  return (pass);\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Cache deliver:`}</p>\n            <ul parentName=\"li\">\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Name`}</strong>{` - api_mesh_deliver`}</p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Type`}</strong>{` - `}<strong parentName=\"p\">{`deliver`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Priority`}</strong>{` - `}<strong parentName=\"p\">{`10`}</strong></p>\n              </li>\n              <li parentName=\"ul\">\n                <p parentName=\"li\"><strong parentName=\"p\">{`Content`}</strong>{`:`}</p>\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-csharp\"\n                  }}>{`if (req.http.x - commerce - bypass - fastly - cache == \"true\") {\n  return (deliver);\n}\n`}</code></pre>\n              </li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`In `}<strong parentName=\"p\">{`Fastly Configuration`}</strong>{` > `}<strong parentName=\"p\">{`Backend Settings`}</strong>{` click `}<strong parentName=\"p\">{`Create`}</strong>{`. Add a new backend with the following information:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Condition`}</strong>{` - `}<inlineCode parentName=\"li\">{`req.url ~ \"^/api/(.*)\" ,`}</inlineCode></li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Address`}</strong>{` - `}<strong parentName=\"li\">{`graph.adobe.io`}</strong></li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Priority`}</strong>{` - `}<strong parentName=\"li\">{`8`}</strong></li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`In `}<strong parentName=\"p\">{`Fastly Configuration`}</strong>{` click `}<strong parentName=\"p\">{`Upload VCL to Fastly`}</strong>{`. Click `}<strong parentName=\"p\">{`Save Config`}</strong>{`.`}</p>\n      </li>\n    </ol>\n    <h2 {...{\n      \"id\": \"test-your-configuration\"\n    }}>{`Test your configuration`}</h2>\n    <p>{`Run the following cURL command, replacing `}<inlineCode parentName=\"p\">{`<Commerce-URL>`}</inlineCode>{` with your Adobe Commerce storefront URL.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`curl --globoff --include '<Commerce-URL>/graphql?query={products(search%3A%20%22c%22){items{sku}}}' --header 'Fastly-Debug: 1' -w \"\\\\n\\\\ntime_starttransfer: %{time_starttransfer}\\\\n\"\n`}</code></pre>\n    <p>{`Review the values of the `}<inlineCode parentName=\"p\">{`x-cache`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`x-cache-hits`}</inlineCode>{` headers to determine if the cache is being used. The first time you run this query, the headers should return:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`x-cache: MISS, MISS\nx-cache-hits: 0\n`}</code></pre>\n    <p>{`Two `}<inlineCode parentName=\"p\">{`MISS`}</inlineCode>{` values and `}<inlineCode parentName=\"p\">{`0`}</inlineCode>{` hits indicate that the cache was not used in this query. Run the cURL command again and you should see the values change to the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`x-cache: MISS, HIT\nx-cache-hits: 1 \n`}</code></pre>\n    <p>{`A value of `}<inlineCode parentName=\"p\">{`MISS, HIT`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`1`}</inlineCode>{` or more hits indicates that the cache is in use. You can also verify cache usage by comparing cached and uncached response times.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","InlineAlert","name","props","console","warn","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","variant","slots","isMDXComponent"],"sourceRoot":""}